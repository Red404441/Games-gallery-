<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Game Gallery — find a game…</title>
<style>
  :root{
    --accent:#1e84c9;
    --accent-2:#63b2cc;
    --card-border: rgba(30,132,201,0.14);
    --text:#043347;
    --glass: rgba(255,255,255,0.72);
  }

  /* Background: Bliss wallpaper (Microsoft-hosted preferred).
     Fallback gradient provided. */
  :root { --bliss-url: url("https://upload.wikimedia.org/wikipedia/en/2/27/Bliss_%28Windows_XP%29.png"); }

  html,body{height:100%;margin:0;font-family: "Segoe UI", Tahoma, Arial, sans-serif;color:var(--text);-webkit-font-smoothing:antialiased;}
  body{
    background:
      linear-gradient(180deg, rgba(255,255,255,0.25), rgba(240,252,255,0.45)),
      var(--bliss-url),
      linear-gradient(180deg,#c9e0f7,#eef7fe);
    background-size: cover;
    background-position: center;
    padding:20px;
  }

  /* When locked, blur the main content behind overlay */
  body.locked .container{ filter: blur(6px) saturate(110%); pointer-events: none; user-select: none; }
  body.locked { overflow: hidden; } /* prevent scroll while locked */

  .container{
    max-width:1200px;margin:0 auto;background:rgba(255,255,255,0.55);border-radius:12px;padding:14px;
    box-shadow: 0 20px 50px rgba(6,30,50,0.12);backdrop-filter: blur(6px) saturate(120%);border:1px solid rgba(255,255,255,0.6);
  }

  header{display:flex;gap:12px;align-items:center;}
  .logo{
    width:84px;height:56px;border-radius:8px;background:linear-gradient(180deg,#e8f6ff,#dff3ff);
    display:flex;align-items:center;justify-content:center;font-weight:800;color:#003a6b;font-size:15px;
    box-shadow: 0 8px 18px rgba(6,32,60,0.06);border:1px solid rgba(0,0,0,0.04)
  }
  h1{margin:0;font-size:22px;color:#00334a;letter-spacing:-0.4px}
  .meta{font-size:13px;color:#09334a;opacity:0.95}

  .top-right{margin-left:auto;display:flex;gap:10px;align-items:center}

  a.contribute{background:linear-gradient(180deg,var(--accent),var(--accent-2));color:white;padding:7px 12px;border-radius:8px;text-decoration:none;font-weight:700;box-shadow:0 8px 22px rgba(98,154,200,0.16)}

  /* audio bubble (aero glass bubble) */
  .audio-bubble{
    width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;
    background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(235,249,255,0.85));
    box-shadow: 0 6px 18px rgba(5,40,70,0.12), inset 0 1px 0 rgba(255,255,255,0.6);
    border:1px solid rgba(255,255,255,0.6);
    cursor:pointer;
    transition: transform .12s ease, box-shadow .12s ease, opacity .12s;
    -webkit-backdrop-filter: blur(6px) saturate(120%);
  }
  .audio-bubble:active{ transform: translateY(1px) scale(.995); }
  .audio-bubble[aria-pressed="true"]{ box-shadow:0 10px 26px rgba(6,40,80,0.14); transform: translateY(-2px); }
  .audio-icon{ width:18px;height:18px;display:block;pointer-events:none; }

  /* search bar */
  .search-row{display:flex;gap:12px;align-items:center;margin-top:14px;}
  .search{
    flex:1;display:flex;align-items:center;gap:10px;background:rgba(255,255,255,0.8);border-radius:12px;padding:10px 12px;border:1px solid rgba(0,0,0,0.06);
    box-shadow: 0 8px 18px rgba(6,32,60,0.04);
  }
  .search input{
    border:0;outline:none;font-size:16px;background:transparent;width:100%;
    color:var(--text);
  }
  .search .hint{font-size:13px;color:#0b4a63;opacity:0.9}

  .results-info{font-size:13px;color:#053147;min-width:150px;text-align:right}

  /* grid wrap */
  .grid-wrap{margin-top:14px;background:linear-gradient(180deg,rgba(255,255,255,0.62),rgba(245,251,255,0.55));padding:14px;border-radius:12px;height:64vh;overflow:auto;border:1px solid rgba(0,0,0,0.04);box-shadow:0 18px 40px rgba(7,30,50,0.06);backdrop-filter:blur(6px)}
  .grid-wrap::-webkit-scrollbar{width:10px;height:10px}
  .grid-wrap::-webkit-scrollbar-thumb{background:rgba(30,132,201,0.18);border-radius:10px;border:2px solid transparent;background-clip:padding-box}

  /* link grid - chunky tiles (option 2) */
  .link-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px;align-items:start}
  .tile{
    display:flex;gap:12px;align-items:center;padding:16px;border-radius:12px;text-decoration:none;color:var(--text);
    background:linear-gradient(180deg,rgba(255,255,255,0.78),rgba(246,253,255,0.7));
    border:1px solid var(--card-border);min-height:78px;box-shadow:0 8px 22px rgba(6,32,60,0.04);transition:transform .25s cubic-bezier(.2,.9,.3,1),box-shadow .25s,background .25s;
    backdrop-filter: blur(6px);
  }
  .tile:hover{transform:translateY(-8px);box-shadow:0 28px 48px rgba(3,27,50,0.12);background:linear-gradient(180deg,rgba(255,255,255,0.9),rgba(248,254,255,0.8))}
  .icon{width:56px;height:56px;border-radius:10px;flex:0 0 56px;display:flex;align-items:center;justify-content:center;overflow:hidden;background:linear-gradient(180deg,#f6fbff,#e6f7ff);border:1px solid rgba(255,255,255,0.6)}
  .icon img{width:40px;height:40px;object-fit:contain}

  .txt{display:flex;flex-direction:column}
  .title{font-weight:800;font-size:16px;color:#00334a;margin-bottom:3px}
  .sub{font-size:13px;color:#164e67;opacity:0.95}

  .note{margin-top:12px;font-size:13px;color:#0b3b53}

  /* animations */
  @keyframes pop { from{opacity:0; transform:translateY(10px) scale(.995)} to{opacity:1; transform:none} }
  .pop{animation:pop 420ms cubic-bezier(.2,.9,.3,1) both}

  /* responsive */
  @media (max-width:720px){
    .link-grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px}
    .icon{width:48px;height:48px;flex:0 0 48px}
    .tile{padding:12px;min-height:64px}
    h1{font-size:18px}
    .audio-bubble{width:40px;height:40px}
  }

  /* focus */
  .tile:focus{outline:3px solid rgba(30,132,201,0.18);outline-offset:4px}

  /* ---------- Lock overlay styles (smaller, tighter) ---------- */
  .lock-overlay{
    position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
    background:rgba(4,12,20,0.45);backdrop-filter: blur(4px) saturate(110%);z-index:9999;
    -webkit-backdrop-filter: blur(4px);
  }

  .lock-panel{
    width:min(480px,92%);background:linear-gradient(180deg,rgba(255,255,255,0.98),rgba(245,251,255,0.96));
    border-radius:12px;padding:16px;border:1px solid rgba(0,0,0,0.06);box-shadow:0 20px 48px rgba(3,20,40,0.32);
    display:flex;flex-direction:column;gap:10px;align-items:stretch;
  }

  .lock-header{display:flex;align-items:center;gap:12px;}
  .lock-logo{width:56px;height:40px;border-radius:8px;background:linear-gradient(180deg,#e8f6ff,#dff3ff);display:flex;align-items:center;justify-content:center;font-weight:800;color:#003a6b}
  .lock-title{font-size:18px;color:#0c3a52;margin:0;font-weight:800}
  .lock-desc{font-size:13px;color:#0b4a63;opacity:0.95}

  .pass-row{display:flex;gap:10px;align-items:center;margin-top:6px}
  .pass-row input{
    flex:1;padding:10px 12px;border-radius:10px;border:1px solid rgba(0,0,0,0.08);font-size:15px;outline:none;
    box-shadow: inset 0 -6px 12px rgba(0,0,0,0.02);background:white;
  }
  .pass-row button{
    padding:9px 12px;border-radius:10px;border:0;background:linear-gradient(180deg,var(--accent),var(--accent-2));color:white;font-weight:700;cursor:pointer;
    box-shadow:0 8px 20px rgba(30,132,201,0.18);
  }

  .err{color:#8b1c1c;background:rgba(139,28,28,0.06);padding:8px;border-radius:8px;border:1px solid rgba(139,28,28,0.08);display:none}

  .lock-hint{font-size:13px;color:#0b4a63;opacity:0.9}

  /* tiny accessibility focus */
  .pass-row input:focus{outline:3px solid rgba(30,132,201,0.14);outline-offset:3px}
  .pass-row button:focus{outline:3px solid rgba(30,132,201,0.14);outline-offset:3px}

  /* small toast */
  .toast{
    position:fixed;right:18px;bottom:18px;background:var(--glass);padding:10px 14px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);
    box-shadow:0 10px 30px rgba(3,20,40,0.12);font-size:13px;color:#043347;z-index:99999;opacity:0;transform:translateY(10px);transition:all .28s cubic-bezier(.2,.9,.3,1);
  }
  .toast.show{opacity:1;transform:none;}

</style>
</head>
<body class="locked">
  <!-- Lock overlay: pops up before accessing the site -->
  <div class="lock-overlay" id="lockOverlay" role="dialog" aria-modal="true" aria-labelledby="lockTitle">
    <div class="lock-panel" role="document">
      <div class="lock-header">
        <div class="lock-logo" aria-hidden="true">GALLERY</div>
        <div>
          <h2 id="lockTitle" class="lock-title">Enter access code</h2>
          <div class="lock-desc">This page is protected. Enter the 4-digit code to continue.</div>
        </div>
      </div>

      <div class="lock-hint">Tip: numeric only. Press Enter after typing.</div>

      <div class="pass-row" style="margin-top:6px;">
        <input id="passInput" type="password" inputmode="numeric" pattern="[0-9]*" maxlength="10" autocomplete="one-time-code" aria-label="Access code" placeholder="Enter code"/>
        <button id="passBtn" aria-label="Unlock">Unlock</button>
      </div>

      <div id="errMsg" class="err" role="status" aria-live="polite">Incorrect code — try again.</div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px;font-size:12px;color:#0b4a63;opacity:0.9">
        <div>Music will play after entering code, press the mute button to stop.</div>
        <div>Session unlock remembered for this tab.</div>
      </div>
    </div>
  </div>

  <div class="container" role="main" aria-hidden="false">
    <header>
      <div class="logo" aria-hidden="true">GALLERY</div>
      <div>
        <h1>The Game Gallery</h1>
        <div class="meta">Frutiger Aero / XP-inspired — everything opens in a new tab.</div>
      </div>

      <div class="top-right" style="align-items:center">
        <!-- audio bubble placed before contribute -->
        <button id="audioBtn" class="audio-bubble" aria-pressed="false" title="Play / pause audio" aria-label="Play music (Music.mp3)">
          <!-- SVG styled minimal speaker icon (play state and pause toggled via JS) -->
          <svg id="audioIcon" class="audio-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path id="speakerPath" d="M5 9v6h4l5 4V5L9 9H5z" fill="#0c3a52"/>
          </svg>
        </button>

        <a class="contribute" href="https://github.com/Red404441/Games-gallery-" target="_blank" rel="noopener">Contribute</a>
      </div>
    </header>

    <div class="search-row" style="margin-bottom:6px">
      <div class="search" role="search" aria-label="Search links">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.35-4.35" stroke="#0b4a63" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="#0b4a63" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <input id="searchInput" placeholder="find a game..." aria-label="Find a game" autocomplete="off"/>
        <div class="hint" style="opacity:0.9">Press / to search</div>
      </div>
      <div class="results-info" id="resultsInfo">119 links</div>
    </div>

    <!-- small place where the iframe used to be; replaced with local-controlled audio bubble -->
    <div style="height:6px;"></div>

    <div class="grid-wrap" id="gridWrap" aria-live="polite">
      <div class="link-grid" id="linkGrid" aria-label="All links"></div>
    </div>

    <div class="note">Note: some links may be blocked by network filters or taken down. Tell me which ones break and I’ll will remove them.</div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
/* === Links (119 total) - DO NOT REMOVE OR REORDER unless you intentionally want to swap === */
const allLinks = [
    {name:"Win10 Games Hub", url:"https://win10.webjeet.me/"},
    {name:"Diep.io", url:"https://diep.io/"},
    {name:"Wings.io", url:"https://wings.io/"},
    {name:"Deeeep.io", url:"https://deeeep.io/"},
    {name:"Brutal.io", url:"https://brutal.io/"},
    {name:"Paper.io", url:"https://paper-io.com/"},
    {name:"QuickDraw", url:"https://quickdraw.withgoogle.com/"},
    {name:"Maths playground", url:"https://www.mathplayground.com/fun-skill-games.html"},
    {name:"Slither.io", url:"https://slither.io/"},
    {name:"Yorg.io", url:"https://yorg.io/"},
    {name:"Vengeance.io", url:"https://venge.io/"},
    {name:"Warbot.io", url:"https://warbot.io/"},
    {name:"Garlic.io", url:"https://garlic.io/"},
    {name:"Snake.io", url:"https://snake.io/"},
    {name:"Card games.io", url:"https://cardgames.io/"},
    {name:"Zombs.io", url:"https://zombs.io/"},
    {name:"Hordes.io", url:"https://hordes.io/"},
    {name:"Chess.com", url:"https://www.chess.com/"},
    {name:"GeForce.com", url:"https://www.geforce.com/"},
    {name:"Kour.io", url:"https://kour.io/"},
    {name:"Neal.fun", url:"https://neal.fun/"},
    {name:"Deadshot.io", url:"https://deadshot.io/"},
    {name:"Oasis Starting Point", url:"https://oasis.decart.ai/starting-point?journey=Dense+Forest"},
    {name:"BitLife", url:"https://bitlifeonline.io/home"},
    {name:"Akinator", url:"https://en.akinator.com/"},
    {name:"Armor Games", url:"https://armorgames.com/"},
    {name:"FreeGames.com", url:"https://www.freegames.com/"},
    {name:"Lagged.com", url:"https://lagged.com/en/"},
    {name:"GamePix.com", url:"https://www.gamepix.com/"},
    {name:"Jetpack Joyride", url:"https://jetpack-joyride.github.io/"},
    {name:"Pogo.com", url:"https://www.pogo.com/"},
    {name:"Gamezop", url:"https://www.gamezop.com/en"},
    {name:"Jopi.com", url:"https://www.jopi.com/"},
    {name:"Poki.ac", url:"https://poki.ac/"},
    {name:"Friv2online", url:"https://www.friv2online.com/poki-games"},
    {name:"KoalaBeast", url:"https://koalabeast.com/"},
    {name:"Lexaloffle", url:"https://www.lexaloffle.com/bbs/?pid=136646#playing"},
    {name:"Fallen London", url:"https://www.fallenlondon.com/"},
    {name:"Granblue Fantasy", url:"https://granbluefantasy.jp/sp/en/"},
    {name:"Corru Observer", url:"https://corru.observer/"},
    {name:"AmongUsPlay", url:"https://amongusplay.online/"},
    {name:"Narrow.one", url:"https://narrow.one/"},
    {name:"FreeGames.org", url:"https://freegames.org/"},
    {name:"Cool Math Games", url:"https://www.coolmathgames.com/"},
    {name:"Territorial.io", url:"https://territorial.io/"},
    {name:"Emupedia / EmuOS", url:"https://emupedia.net/beta/emuos/"},
    {name:"IzzyGames", url:"https://www.izzygames.com/exhibit-of-sorrows-t6997.html?fullscreen=true"},
    {name:"Desura Games", url:"https://www.desura.games/ipad-games"},
    {name:"Kevin Games Slendrina", url:"https://kevin.games/slendrina-must-die-the-cellar"},
    {name:"Toogame", url:"https://www.toogame.com/"},
    {name:"Windows 93", url:"http://v1.windows93.net/"},
    {name:"Polytrack", url:"https://www.kodub.com/apps/polytrack"},
    {name:"Now.gg", url:"https://now.gg/"},
    {name:"PlayRetroGames", url:"https://playretrogames.online/"},
    {name:"Gamaverse Mobile", url:"https://gamaverse.com/mobile/"},
    {name:"FreeRiderHD", url:"https://www.freeriderhd.com/"},
    {name:"KBHGames", url:"https://kbhgames.com/"},
    {name:"Pokemon Showdown", url:"https://play.pokemonshowdown.com/"},
    {name:"Drift.io", url:"https://drift.io/?room=nedRVhuAq"},
    {name:"Time Shooter 2", url:"https://watchdocumentaries.com/time-shooter-2-game/"},
    {name:"Combat Reloaded", url:"https://www.gameflare.com/online-game/combat-reloaded/"},
    {name:"Tetris", url:"https://www.lumpty.com/amusements/games/tetris/tetris.html"},
    {name:"ArcadeSpot", url:"https://arcadespot.com/"},
    {name:"MCraft", url:"https://mcraft.fun/"},
    {name:"Two Player Games", url:"https://www.twoplayergames.org/"},
    {name:"Slowroads.io", url:"https://slowroads.io/"},
    {name:"Games Unblocked", url:"https://sites.google.com/view/games-unblocked/"},
    {name:"Slice-Master.io", url:"https://slice-master.io/"},
    {name:"BasketBros.io", url:"https://basketbrosio.com/"},
    {name:"GameSnacks", url:"https://gamesnacks.com/"},
    {name:"Yapi Games", url:"https://www.yapigames.com/mobilegames/"},
    {name:"NoInternetGame", url:"https://nointernetgame.com/"},
    {name:"CatMario", url:"https://catmario.eu/"},
    {name:"PCJS", url:"https://www.pcjs.org/blog/2015/09/21/"},
    {name:"VirtualXP", url:"https://lrusso.github.io/VirtualXP/VirtualXP.htm"},
    {name:"Elgoog", url:"https://elgoog.im/"},
    {name:"MyEmulator", url:"https://myemulator.onl/"},
    {name:"Internet Arcade", url:"https://archive.org/details/internetarcade"},
    {name:"RomsFun", url:"https://romsfun.com/"},
    {name:"Watch Documentaries Games", url:"https://watchdocumentaries.com/games/"},
    {name:"Gameflare Hub", url:"https://www.gameflare.com/"},
    {name:"PlayHop", url:"https://playhop.com/"},
    {name:"Survival Race", url:"https://www.onlinegames.io/survival-race/index.html"},
    {name:"Miniclip", url:"https://www.miniclip.com/"},
    {name:"Skibidi.io", url:"https://skibidi.io/games"},
    {name:"Eaglercraft", url:"https://eaglercraft.q13x.com/1.8-js/?retina=true"},
    {name:"MathPlayZone Arcade", url:"https://mathplayzone.com/arcade/"},
    {name:"CookieClicker.one", url:"https://cookieclicker.one/"},
    {name:"AngusNicNeven", url:"https://angusnicneven.com/"},
    {name:"Pokerogue.io", url:"https://pokerogue.io/"},
    {name:"Tetr.io", url:"https://tetr.io/"},
    {name:"UG17 Games", url:"https://ug17.github.io/"},
    {name:"MAFA.com", url:"https://www.mafa.com/"},
    {name:"Crossy-Road.io", url:"https://crossy-road.io/"},
    {name:"Crossy-Road", url:"https://crossy-road.com/"},
    {name:"Games-Site", url:"https://games-site.github.io/"},
    {name:"AzGames.io", url:"https://azgames.io/?gid=S50"},
    {name:"Uptoplay.net", url:"https://uptoplay.net/"},
    {name:"Mario 64 Online", url:"https://red404441.github.io/Mario64-online/"},
	 {name:"Osu!", url:"https://webosu.online/"},
];

/* helper: safe favicon source (with XP-esque fallback) */
function favUrl(u){
  try{
    const p = new URL(u);
    return `https://www.google.com/s2/favicons?domain=${p.hostname}&sz=64`;
  }catch(e){
    return '';
  }
}

/* XP-style SVG fallback as data URL (a tiny "folder/glass" feel) */
const xpFallbackSvg = encodeURIComponent(
  `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64"><rect rx="8" ry="8" width="64" height="64" fill="#eaf6ff"/><g transform="translate(6,10)"><rect width="44" height="24" rx="4" fill="#d8eefc"/><rect y="20" width="44" height="14" rx="4" fill="#e9f7ff"/></g></svg>`
);

/* Render tiles (fast, accessible). On first render give pop animation; subsequent renders skip animation to avoid DOM thrash. */
const grid = document.getElementById('linkGrid');
let initialRendered = false;
function normalizeDisplayName(name){
  // trim, collapse whitespace, keep user's chosen casing mostly
  return name.replace(/\s+/g,' ').trim();
}
function render(list){
  grid.innerHTML = '';
  list.forEach((l,i)=>{
    const a = document.createElement('a');
    a.className = 'tile';
    if(!initialRendered) a.classList.add('pop');
    a.href = l.url;
    a.target = '_blank';
    a.rel = 'noopener noreferrer';
    a.setAttribute('aria-label', l.name);

    const ic = document.createElement('div'); ic.className = 'icon';
    const im = document.createElement('img'); im.alt = l.name + ' icon';
    im.src = favUrl(l.url);
    // if favicon fails, swap to our XP-ish fallback
    im.onerror = function(){
      this.onerror=null;
      this.src = `data:image/svg+xml;utf8,${xpFallbackSvg}`;
    };
    ic.appendChild(im);

    const t = document.createElement('div'); t.className = 'txt';
    const title = document.createElement('div'); title.className='title';
    title.textContent = normalizeDisplayName(l.name);
    const sub = document.createElement('div'); sub.className='sub';
    try{ sub.textContent = (new URL(l.url)).hostname.replace('www.',''); }catch(e){ sub.textContent=l.url; }
    t.appendChild(title); t.appendChild(sub);

    a.appendChild(ic); a.appendChild(t);
    grid.appendChild(a);
  });

  Array.from(grid.querySelectorAll('.tile')).forEach(el => el.tabIndex = 0);
  document.getElementById('resultsInfo').textContent = `${list.length} links`;
  initialRendered = true;
}

/* initial render (all) */
render(allLinks);

/* ===== Search behaviour: debounce + case-insensitive substring + light fuzzy-ish split scoring ===== */
const searchInput = document.getElementById('searchInput');

function fuzzyScore(hay, needle){
  // very small, fast fuzzy scoring: consecutive characters score more
  hay = hay.toLowerCase();
  needle = needle.toLowerCase();
  if(!needle) return 0;
  if(hay.includes(needle)) return 100 + (needle.length * 3);
  // loose subsequence check
  let i=0,j=0,score=0;
  while(i<hay.length && j<needle.length){
    if(hay[i] === needle[j]){ score += 2; j++; }
    i++;
  }
  if(j === needle.length) return score;
  return 0;
}

function doFilter(q){
  if(!q) { render(allLinks); return; }
  const qtrim = q.trim().toLowerCase();
  // search by name primarily, then hostname. score and sort descending
  const candidates = allLinks.map(l => {
    const name = l.name || '';
    const host = (() => { try{ return (new URL(l.url)).hostname }catch(e){return l.url;} })();
    const score = Math.max(fuzzyScore(name, qtrim), fuzzyScore(host, qtrim));
    return {l, score};
  }).filter(x => x.score > 0).sort((a,b)=>b.score - a.score).map(x=>x.l);
  render(candidates);
}

/* debounce helper */
function debounce(fn, wait){
  let t = null;
  return function(...args){
    clearTimeout(t);
    t = setTimeout(()=>fn.apply(this,args), wait);
  };
}

const debouncedFilter = debounce((val)=> doFilter(val), 120);
searchInput.addEventListener('input', (e) => debouncedFilter(e.target.value));

/* quick focus shortcut: press / to focus search (like many launchers) */
document.addEventListener('keydown', (e) => {
  if(e.key === '/' && document.activeElement !== searchInput){
    e.preventDefault();
    searchInput.focus();
    searchInput.select();
  }
});

/* Optional: keyboard navigation inside grid (arrows) */
(function arrowNav(){
  const gridEl = document.getElementById('linkGrid');
  gridEl.addEventListener('keydown', function(e){
    const items = Array.from(gridEl.querySelectorAll('.tile'));
    const idx = items.indexOf(document.activeElement);
    if(idx === -1) return;
    const cols = Math.max(1, Math.round(gridEl.clientWidth / 240));
    if(e.key === 'ArrowRight'){ e.preventDefault(); items[Math.min(idx+1, items.length-1)].focus(); }
    if(e.key === 'ArrowLeft'){ e.preventDefault(); items[Math.max(idx-1, 0)].focus(); }
    if(e.key === 'ArrowDown'){ e.preventDefault(); items[Math.min(idx+cols, items.length-1)].focus(); }
    if(e.key === 'ArrowUp'){ e.preventDefault(); items[Math.max(idx-cols, 0)].focus(); }
  });
})();

/* ---------------- Audio: local Music.mp3 asset, aero bubble UI ----------------
   - file expected at same directory: Music.mp3
   - play is attempted on unlock (counts as user gesture)
   - user can toggle via bubble; state remembered per-tab (but audio won't auto-resume across reload if browser blocks)
*/
const audioBtn = document.getElementById('audioBtn');
const audioIcon = document.getElementById('audioIcon');
let audio = null;
let audioPlaying = false;
const AUDIO_SRC = 'Music.mp3'; // drop Music.mp3 in your repo (same folder as this file)

function createAudio(){
  if(audio) return;
  audio = new Audio(AUDIO_SRC);
  audio.loop = true;
  audio.preload = 'auto';
  audio.volume = 0.6;
  audio.addEventListener('play', () => {
    audioPlaying = true;
    audioBtn.setAttribute('aria-pressed','true');
    setAudioIconState(true);
    showToast('Music playing');
  });
  audio.addEventListener('pause', () => {
    audioPlaying = false;
    audioBtn.setAttribute('aria-pressed','false');
    setAudioIconState(false);
    showToast('Music paused');
  });
  audio.addEventListener('error', () => {
    // e.g., file missing -> inform user
    showToast('Audio file not found (drop Music.mp3 into the repo).', 4000);
    audio = null;
    audioPlaying = false;
    audioBtn.setAttribute('aria-pressed','false');
    setAudioIconState(false);
  });
}

function setAudioIconState(isPlaying){
  // swap between speaker and pause glyphs
  if(isPlaying){
    audioIcon.innerHTML = `<path d="M6 9v6h4l5 4V5L10 9H6z" fill="#0c3a52"/><rect x="17" y="8" width="2" height="8" rx="0.5" fill="#0c3a52"/><rect x="20" y="8" width="2" height="8" rx="0.5" fill="#0c3a52"/>`;
  }else{
    // single speaker icon (play-ready)
    audioIcon.innerHTML = `<path d="M5 9v6h4l5 4V5L9 9H5z" fill="#0c3a52"/>`;
  }
}

audioBtn.addEventListener('click', (e) => {
  e.preventDefault();
  createAudio();
  if(!audio){
    // probably error creating audio; createAudio will show toast
    return;
  }
  if(audioPlaying){
    audio.pause();
  }else{
    audio.play().catch(()=> {
      // if browser blocks, we show toast — user needs to interact (but unlock is a gesture)
      showToast('Browser prevented autoplay. Press play again or unlock the site first.', 3000);
    });
  }
});

/* attempt autoplay after unlock or if previously unlocked in this session */
function tryPlayAudio(){
  try{
    createAudio();
    if(!audio) return;
    audio.play().catch(() => {
      // ignore; show subtle message if user expects it
      showToast('Autoplay blocked by browser. Tap the play button to start audio.', 2800);
    });
  }catch(e){
    // ignore errors
  }
}

/* small toast helper */
const toastEl = document.getElementById('toast');
let toastTimer = null;
function showToast(text, ms = 1700){
  toastEl.textContent = text;
  toastEl.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=>{ toastEl.classList.remove('show'); }, ms);
}

/* ---------------- Lock overlay logic -------------- */
const LOCK_CODE = '4589';
const overlay = document.getElementById('lockOverlay');
const passInput = document.getElementById('passInput');
const passBtn = document.getElementById('passBtn');
const errMsg = document.getElementById('errMsg');

function unlock(remember = true){
  // hide overlay and allow interaction
  document.body.classList.remove('locked');
  overlay.style.display = 'none';
  errMsg.style.display = 'none';
  try{ if(remember) sessionStorage.setItem('gallery_unlocked','1'); }catch(e){}
  // focus search for convenience
  setTimeout(()=> {
    try{ searchInput.focus(); }catch(e){} 
  }, 40);
  // attempt to auto-play audio (unlock counts as a user gesture)
  tryPlayAudio();
}

function showError(text){
  errMsg.textContent = text || 'Incorrect code — try again.';
  errMsg.style.display = 'block';
  // tiny shake animation (visual)
  overlay.animate([{transform:'translateX(-6px)'},{transform:'translateX(6px)'},{transform:'translateX(0)'}],{duration:260,iterations:1});
  passInput.focus();
  passInput.select();
}

function tryUnlock(){
  const val = (passInput.value || '').trim();
  if(val === LOCK_CODE){
    unlock(true);
  }else{
    showError('Incorrect code — try again.');
  }
}

/* button and enter handling */
passBtn.addEventListener('click', tryUnlock);
passInput.addEventListener('keydown', (e) => {
  if(e.key === 'Enter'){ e.preventDefault(); tryUnlock(); }
  if(e.key === 'Escape'){ e.preventDefault(); passInput.value=''; errMsg.style.display='none'; }
});

/* On load: check sessionStorage for existing unlock */
window.addEventListener('load', () => {
  try{
    const unlocked = sessionStorage.getItem('gallery_unlocked') === '1';
    if(unlocked){
      // if session says unlocked, reveal and attempt audio play (no user gesture here may block)
      unlock(false); // already unlocked this tab
      // tryPlayAudio() will attempt to play, but browser may block autoplay without a gesture.
      tryPlayAudio();
    }else{
      // ensure overlay visible and focus input
      document.body.classList.add('locked');
      overlay.style.display = 'flex';
      passInput.focus();
      passInput.select();
    }
  }catch(e){
    // fallback: show overlay
    document.body.classList.add('locked');
    overlay.style.display = 'flex';
    passInput.focus();
  }
});

/* Prevent focusing underlying elements while locked */
document.addEventListener('focusin', (e) => {
  if(document.body.classList.contains('locked')){
    if(!overlay.contains(e.target)){
      e.stopPropagation();
      passInput.focus();
    }
  }
});

/* Accessibility: announce overlay presence */
(function announceLock(){
  const live = document.createElement('div');
  live.setAttribute('aria-live','polite');
  live.style.position='absolute'; live.style.left='-9999px';
  live.textContent = 'This site is protected. Enter code to continue.';
  document.body.appendChild(live);
})();

</script>
</body>
</html>
